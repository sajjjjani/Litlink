<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore - LitLink Dashboard</title>
    <link rel="icon" type="image/png" href="../images/litlink-logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #2c1810;
            color: #f5e6d3;
            overflow-x: hidden;
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* Animation classes */
        .fade-in { animation: fadeIn 0.6s ease forwards; }
        .fade-in-up { animation: fadeInUp 0.8s ease forwards; }
        .slide-in-left { animation: slideInLeft 0.8s ease forwards; }
        .slide-in-right { animation: slideInRight 0.8s ease forwards; }
        .scale-in { animation: scaleIn 0.6s ease forwards; }
        
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        .delay-5 { animation-delay: 0.5s; }

        /* ===== HEADER ===== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(26, 15, 10, 0.95);
            backdrop-filter: blur(10px);
            z-index: 999;
            padding: 15px 40px;
            border-bottom: 1px solid rgba(245, 230, 211, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Logo - Matching explore.html style */
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #f5e6d3;
            text-decoration: none;
            animation: fadeIn 0.8s ease;
        }

        .logo i {
            font-size: 1.8rem;
            color: #d4b5a0;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            position: relative;
            margin: 0 32px;
        }

        /* Search Results Dropdown */
        .search-results-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            right: 0;
            background: #3d2617;
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 16px;
            max-height: 500px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: none;
        }
        
        .search-results-dropdown.show {
            display: block;
            animation: fadeInUp 0.3s ease;
        }
        
        .search-results-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(245, 230, 211, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-results-header h4 {
            color: #f5e6d3;
            font-size: 1rem;
            margin: 0;
        }
        
        .search-results-close {
            background: none;
            border: none;
            color: #d4b5a0;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .search-results-close:hover {
            background: rgba(245, 230, 211, 0.1);
            color: #f5e6d3;
        }
        
        .search-results-list {
            padding: 10px;
        }
        
        .search-result-item {
            display: flex;
            gap: 15px;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
            border: 1px solid transparent;
        }
        
        .search-result-item:hover {
            background: rgba(245, 230, 211, 0.05);
            border-color: rgba(245, 230, 211, 0.2);
        }
        
        .search-result-cover {
            width: 60px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }
        
        .search-result-info {
            flex: 1;
            min-width: 0;
        }
        
        .search-result-title {
            color: #f5e6d3;
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .search-result-author {
            color: #d4b5a0;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        
        .search-results-empty {
            padding: 40px 20px;
            text-align: center;
            color: #d4b5a0;
        }
        
        .search-results-empty i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }
        
        /* Custom Modal System */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }
        
        .custom-modal {
            background: #3d2617;
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            animation: scaleIn 0.3s ease forwards;
            position: relative;
        }
        
        .custom-modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .custom-modal-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .custom-modal-icon.info {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        
        .custom-modal-icon.success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .custom-modal-icon.warning {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
        }
        
        .custom-modal-icon.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .custom-modal-icon.confirm {
            background: rgba(217, 119, 6, 0.2);
            color: #d97706;
        }
        
        .custom-modal-title {
            color: #f5e6d3;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            flex: 1;
        }
        
        .custom-modal-close {
            background: none;
            border: none;
            color: #d4b5a0;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .custom-modal-close:hover {
            background: rgba(245, 230, 211, 0.1);
            color: #f5e6d3;
        }
        
        .custom-modal-body {
            color: #d4b5a0;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .custom-modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .custom-modal-btn {
            padding: 12px 24px;
            border: 2px solid;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 100px;
        }
        
        .custom-modal-btn-primary {
            background: rgba(245, 230, 211, 0.1);
            border-color: rgba(245, 230, 211, 0.3);
            color: #f5e6d3;
        }
        
        .custom-modal-btn-primary:hover {
            background: rgba(245, 230, 211, 0.2);
            border-color: rgba(245, 230, 211, 0.5);
        }
        
        .custom-modal-btn-secondary {
            background: transparent;
            border-color: rgba(212, 181, 160, 0.3);
            color: #d4b5a0;
        }
        
        .custom-modal-btn-secondary:hover {
            background: rgba(212, 181, 160, 0.1);
            border-color: rgba(212, 181, 160, 0.5);
        }
        
        .custom-modal-btn-danger {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
        
        .custom-modal-btn-danger:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
        }

        .search-bar input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            background: rgba(245, 230, 211, 0.1);
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 50px;
            color: #f5e6d3;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #f5e6d3;
            background: rgba(245, 230, 211, 0.05);
        }

        .search-bar input::placeholder {
            color: #d4b5a0;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #d4b5a0;
        }

        /* Enhanced User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 50px;
            transition: all 0.3s ease;
            position: relative;
        }

        .user-profile:hover {
            background: rgba(245, 230, 211, 0.05);
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #fff;
            font-size: 1.1rem;
            border: 2px solid rgba(245, 230, 211, 0.2);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .user-profile:hover .user-avatar {
            transform: scale(1.05);
            border-color: #f5e6d3;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: #f5e6d3;
            font-size: 0.95rem;
        }

        /* Dropdown Menu */
        .user-dropdown {
            position: absolute;
            top: calc(100% + 5px);
            right: 0;
            background: #3d2617;
            border: 1px solid rgba(245, 230, 211, 0.2);
            border-radius: 12px;
            padding: 8px 0;
            min-width: 200px;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .user-profile:hover .user-dropdown {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .dropdown-item {
            padding: 12px 20px;
            color: #f5e6d3;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .dropdown-item:hover {
            background: rgba(245, 230, 211, 0.1);
        }

        .dropdown-item i {
            width: 18px;
            text-align: center;
            color: #d4b5a0;
        }

        .dropdown-divider {
            height: 1px;
            background: rgba(245, 230, 211, 0.1);
            margin: 6px 0;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            padding-top: 100px;
            max-width: 1400px;
            margin: 0 auto;
            padding-left: 40px;
            padding-right: 40px;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 48px;
        }

        .page-title {
            font-size: 2.25rem;
            font-weight: 700;
            color: #f5e6d3;
            line-height: 1.3;
            background: linear-gradient(135deg, #f5e6d3 0%, #d4b5a0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ===== SECTIONS ===== */
        .section {
            margin-bottom: 64px;
            opacity: 0;
        }

        .section.animated {
            animation: fadeInUp 0.8s ease forwards;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 600;
            color: #f5e6d3;
        }

        .section-icon {
            font-size: 1.6rem;
            animation: float 3s ease-in-out infinite;
        }

        .view-all {
            color: #d4b5a0;
            text-decoration: none;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(245, 230, 211, 0.05);
        }

        .view-all:hover {
            color: #f5e6d3;
            background: rgba(245, 230, 211, 0.1);
            transform: translateX(5px);
        }

        /* ===== ENHANCED GENRES WITH BOOKS ===== */
        .genres-container {
            position: relative;
            margin-bottom: 40px;
        }

        .genres-scroll {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 20px 10px;
            scrollbar-width: thin;
            scrollbar-color: rgba(245, 230, 211, 0.2) transparent;
            cursor: grab;
        }

        .genres-scroll:active {
            cursor: grabbing;
        }

        .genres-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .genres-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .genres-scroll::-webkit-scrollbar-thumb {
            background: rgba(245, 230, 211, 0.2);
            border-radius: 3px;
        }

        /* Genre Category Container */
        .genre-category {
            flex: 0 0 auto;
            width: 320px;
            background: #3d2617;
            border: 2px solid rgba(245, 230, 211, 0.1);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
        }

        .genre-category:hover {
            background: #4a3123;
            border-color: #f5e6d3;
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .genre-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(245, 230, 211, 0.1);
        }

        .genre-category-icon {
            font-size: 2.5rem;
        }

        .genre-category-name {
            font-weight: 700;
            color: #f5e6d3;
            font-size: 1.2rem;
        }

        .genre-books-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .genre-book-item {
            display: flex;
            gap: 15px;
            padding: 12px;
            background: rgba(245, 230, 211, 0.05);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .genre-book-item:hover {
            background: rgba(245, 230, 211, 0.1);
            transform: translateX(5px);
        }

        .genre-book-cover {
            width: 60px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .genre-book-info {
            flex: 1;
        }

        .genre-book-title {
            font-weight: 600;
            color: #f5e6d3;
            font-size: 0.95rem;
            margin-bottom: 5px;
            line-height: 1.3;
        }

        .genre-book-author {
            color: #d4b5a0;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .genre-book-description {
            color: #8b6f47;
            font-size: 0.8rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .genre-action-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(245, 230, 211, 0.1);
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 10px;
            color: #f5e6d3;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .genre-action-btn:hover {
            background: rgba(245, 230, 211, 0.15);
            border-color: #f5e6d3;
            transform: translateY(-2px);
        }

        /* Scroll buttons */
        .scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            background: rgba(61, 38, 23, 0.9);
            border: 2px solid rgba(245, 230, 211, 0.3);
            border-radius: 50%;
            color: #f5e6d3;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            z-index: 10;
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
        }

        .genres-container:hover .scroll-btn {
            opacity: 1;
            visibility: visible;
        }

        .scroll-btn:hover {
            background: rgba(245, 230, 211, 0.2);
            border-color: #f5e6d3;
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .scroll-left {
            left: -20px;
        }

        .scroll-right {
            right: -20px;
        }

        /* ===== VOICE ROOMS ===== */
        .voice-rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        .voice-room-card {
            background: #3d2617;
            border: 2px solid rgba(245, 230, 211, 0.1);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.4s ease;
            cursor: pointer;
            animation: scaleIn 0.6s ease forwards;
        }

        .voice-room-card:hover {
            border-color: rgba(245, 230, 211, 0.3);
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .room-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 20px;
        }

        .room-host-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            flex-shrink: 0;
            border: 2px solid rgba(245, 230, 211, 0.2);
        }

        .room-info {
            flex: 1;
        }

        .room-live-badge {
            background: linear-gradient(135deg, #ff3838 0%, #ff6b6b 100%);
            color: #fff;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }

        .room-live-badge i {
            font-size: 0.5rem;
        }

        .room-title {
            font-weight: 600;
            color: #f5e6d3;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .room-meta {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: #d4b5a0;
            margin-bottom: 16px;
        }

        .room-meta span {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .room-participants {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .participants-avatars {
            display: flex;
            margin-right: 4px;
        }

        .participant-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid #3d2617;
            margin-left: -8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .participant-avatar:first-child {
            margin-left: 0;
        }

        .participants-count {
            font-size: 0.9rem;
            color: #d4b5a0;
        }

        .room-join-btn {
            width: 100%;
            padding: 14px;
            background: rgba(245, 230, 211, 0.1);
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 12px;
            color: #f5e6d3;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .room-join-btn:hover {
            background: rgba(245, 230, 211, 0.15);
            border-color: #f5e6d3;
            transform: translateY(-2px);
        }

        /* ===== DISCUSSIONS ===== */
        .discussions-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .discussion-card {
            background: #3d2617;
            border: 2px solid rgba(245, 230, 211, 0.1);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
            animation: slideInLeft 0.6s ease forwards;
        }

        .discussion-card:hover {
            border-color: rgba(245, 230, 211, 0.3);
            transform: translateY(-4px);
        }

        .discussion-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .discussion-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            font-size: 1rem;
            border: 2px solid rgba(245, 230, 211, 0.2);
        }

        .discussion-user-info {
            flex: 1;
        }

        .discussion-author {
            font-weight: 600;
            color: #f5e6d3;
            font-size: 1rem;
        }

        .discussion-time {
            font-size: 0.85rem;
            color: #d4b5a0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .discussion-category {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(245, 230, 211, 0.1);
            border-radius: 20px;
            font-size: 0.8rem;
            color: #f5e6d3;
            font-weight: 600;
        }

        .discussion-title {
            font-weight: 600;
            color: #f5e6d3;
            font-size: 1.2rem;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .discussion-excerpt {
            color: #d4b5a0;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .discussion-stats {
            display: flex;
            gap: 24px;
            font-size: 0.9rem;
            color: #d4b5a0;
        }

        .discussion-stat {
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s ease;
        }

        .discussion-stat:hover {
            color: #f5e6d3;
        }

        .discussion-stat i {
            font-size: 1rem;
        }

        /* ===== READER MATCHES ===== */
        .matches-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
        }

        .match-card {
            background: #3d2617;
            border: 2px solid rgba(245, 230, 211, 0.1);
            border-radius: 20px;
            padding: 28px;
            text-align: center;
            transition: all 0.4s ease;
            cursor: pointer;
            animation: scaleIn 0.6s ease forwards;
        }

        .match-card:hover {
            border-color: rgba(245, 230, 211, 0.3);
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .match-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            font-size: 1.8rem;
            margin: 0 auto 20px;
            border: 3px solid rgba(245, 230, 211, 0.2);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .match-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .match-card:hover .match-avatar {
            transform: scale(1.1);
            border-color: #f5e6d3;
        }

        .match-score {
            display: inline-block;
            background: rgba(16, 168, 129, 0.2);
            color: #1dd1a1;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 16px;
            border: 1px solid rgba(29, 209, 161, 0.3);
        }

        .match-name {
            font-weight: 700;
            color: #f5e6d3;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .match-genres {
            color: #d4b5a0;
            font-size: 0.9rem;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .match-btn {
            width: 100%;
            padding: 14px;
            background: rgba(245, 230, 211, 0.1);
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 12px;
            color: #f5e6d3;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .match-btn:hover {
            background: rgba(245, 230, 211, 0.15);
            border-color: #f5e6d3;
            transform: translateY(-2px);
        }

        /* ===== BOOK CLUBS ===== */
        .clubs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 24px;
        }

        .club-card {
            background: #3d2617;
            border: 2px solid rgba(245, 230, 211, 0.1);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.4s ease;
            cursor: pointer;
            animation: slideInRight 0.6s ease forwards;
        }

        .club-card:hover {
            border-color: rgba(245, 230, 211, 0.3);
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .club-banner {
            width: 100%;
            height: 140px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            transition: all 0.3s ease;
        }

        .club-card:hover .club-banner {
            transform: scale(1.02);
        }

        .club-content {
            padding: 24px;
        }

        .club-title {
            font-weight: 700;
            color: #f5e6d3;
            font-size: 1.3rem;
            margin-bottom: 12px;
        }

        .club-description {
            color: #d4b5a0;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .club-current-book {
            display: inline-block;
            background: rgba(245, 230, 211, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #f5e6d3;
            margin-bottom: 20px;
            border: 1px solid rgba(245, 230, 211, 0.2);
        }

        .club-stats {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: #d4b5a0;
            margin-bottom: 20px;
        }

        .club-stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .club-join-btn {
            width: 100%;
            padding: 14px;
            background: rgba(245, 230, 211, 0.1);
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 12px;
            color: #f5e6d3;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .club-join-btn:hover {
            background: rgba(245, 230, 211, 0.15);
            border-color: #f5e6d3;
            transform: translateY(-2px);
        }

        /* ===== NEW: QUICK ACTIONS SECTION ===== */
        .quick-actions-section {
            margin-bottom: 80px;
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 40px;
        }

        .quick-action-card {
            background: #3d2617;
            border: 2px solid rgba(245, 230, 211, 0.1);
            border-radius: 20px;
            padding: 32px;
            text-align: center;
            transition: all 0.4s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 240px;
        }

        .quick-action-card:hover {
            border-color: rgba(245, 230, 211, 0.3);
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .quick-action-icon {
            font-size: 3.5rem;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }

        .quick-action-card:hover .quick-action-icon {
            transform: scale(1.2) rotate(5deg);
        }

        .quick-action-card h3 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #f5e6d3;
            margin-bottom: 12px;
        }

        .quick-action-card p {
            color: #d4b5a0;
            font-size: 0.95rem;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .quick-action-btn {
            padding: 12px 32px;
            background: rgba(245, 230, 211, 0.1);
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 12px;
            color: #f5e6d3;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .quick-action-btn:hover {
            background: rgba(245, 230, 211, 0.15);
            border-color: #f5e6d3;
            transform: translateY(-2px);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .header {
                padding: 15px 24px;
            }

            .main-content {
                padding-left: 24px;
                padding-right: 24px;
            }

            .voice-rooms-grid,
            .matches-list,
            .clubs-grid,
            .quick-actions-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            .genre-category {
                width: 280px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .search-bar {
                width: 100%;
                max-width: 100%;
                margin: 10px 0;
                order: 3;
            }

            .main-content {
                padding-top: 140px;
                padding-left: 16px;
                padding-right: 16px;
            }

            .page-title {
                font-size: 1.8rem;
            }

            .section-title {
                font-size: 1.3rem;
            }

            .user-name {
                display: none;
            }

            .user-profile {
                padding: 6px 12px;
            }

            .user-avatar {
                width: 40px;
                height: 40px;
            }

            .genre-category {
                width: 260px;
            }

            .scroll-btn {
                opacity: 1;
                visibility: visible;
                background: rgba(61, 38, 23, 0.8);
                width: 36px;
                height: 36px;
            }

            .scroll-left {
                left: -10px;
            }

            .scroll-right {
                right: -10px;
            }

            .voice-rooms-grid,
            .matches-list,
            .clubs-grid,
            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding-top: 160px;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .view-all {
                align-self: flex-end;
            }

            .genre-category {
                width: 240px;
                padding: 16px;
            }

            .quick-action-card {
                padding: 24px;
                min-height: 200px;
            }
        }

        /* ===== BOOK DETAIL MODAL ===== */
        .book-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .book-detail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 24, 16, 0.95);
            backdrop-filter: blur(5px);
        }

        .book-detail-content {
            position: relative;
            background: #3d2617;
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 20px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: scaleIn 0.3s ease;
            z-index: 10001;
        }

        .book-detail-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(245, 230, 211, 0.1);
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: #f5e6d3;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .book-detail-close:hover {
            background: rgba(245, 230, 211, 0.2);
            transform: rotate(90deg);
        }

        .book-detail-main {
            display: flex;
            gap: 40px;
            margin-top: 20px;
        }

        .book-detail-cover {
            flex-shrink: 0;
        }

        .book-detail-cover img {
            width: 200px;
            height: 300px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .book-detail-info {
            flex: 1;
        }

        .book-detail-title {
            font-size: 2rem;
            font-weight: 700;
            color: #f5e6d3;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        .book-detail-authors {
            margin-bottom: 30px;
        }

        .book-author-item {
            margin-bottom: 15px;
        }

        .book-author-item strong {
            color: #f5e6d3;
            font-size: 1.1rem;
            display: block;
            margin-bottom: 5px;
        }

        .author-bio {
            color: #d4b5a0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .book-detail-description {
            margin-bottom: 30px;
        }

        .book-detail-description h3 {
            color: #f5e6d3;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .book-detail-description p {
            color: #d4b5a0;
            line-height: 1.7;
            font-size: 1rem;
        }

        .toggle-description-btn {
            background: transparent;
            border: none;
            color: #d4b5a0;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .book-detail-meta {
            margin-bottom: 30px;
        }

        .book-detail-meta h3 {
            color: #f5e6d3;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .book-meta-table {
            width: 100%;
            border-collapse: collapse;
        }

        .book-meta-table td {
            padding: 10px 0;
            border-bottom: 1px solid rgba(245, 230, 211, 0.1);
        }

        .book-meta-table td:first-child {
            color: #d4b5a0;
            font-weight: 600;
            width: 150px;
        }

        .book-meta-table td:last-child {
            color: #f5e6d3;
        }

        .book-detail-genres {
            margin-bottom: 30px;
        }

        .book-detail-genres h3 {
            color: #f5e6d3;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .genre-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .genre-tag {
            background: rgba(245, 230, 211, 0.1);
            border: 2px solid rgba(245, 230, 211, 0.2);
            border-radius: 20px;
            padding: 8px 16px;
            color: #f5e6d3;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .genre-tag:hover {
            background: rgba(245, 230, 211, 0.15);
            border-color: #f5e6d3;
            transform: translateY(-2px);
        }

        .book-detail-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .action-btn {
            padding: 14px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            border: 2px solid;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #5c3a28 0%, #3d2417 100%);
            border-color: #5c3a28;
            color: #f5e6d3;
        }

        .action-btn.primary:hover {
            background: linear-gradient(135deg, #3d2417 0%, #2c1810 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .action-btn.secondary {
            background: rgba(245, 230, 211, 0.1);
            border-color: rgba(245, 230, 211, 0.2);
            color: #f5e6d3;
        }

        .action-btn.secondary:hover {
            background: rgba(245, 230, 211, 0.15);
            border-color: #f5e6d3;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .book-detail-main {
                flex-direction: column;
                gap: 20px;
            }

            .book-detail-cover {
                align-self: center;
            }

            .book-detail-cover img {
                width: 150px;
                height: 225px;
            }

            .book-detail-actions {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header fade-in">
        <div class="header-content">
            <!-- Updated Logo pointing to dashboard -->
            <a href="dashboard.html" class="logo">
                <i class="fas fa-book-open"></i>
                <span>Litlink</span>
            </a>
            
            <div class="search-bar">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="dashSearchInput" placeholder="Search book, clubs, genres, users...">
            </div>
            
            <!-- Dynamic User Profile - Will be populated by JavaScript -->
            <div class="user-profile">
                <div class="user-avatar">U</div>
                <div class="user-info">
                    <span class="user-name">Loading...</span>
                </div>
                <div class="user-dropdown">
                    <a href="../Profile/profile.html" class="dropdown-item">
                        <i class="fas fa-user"></i> Profile
                    </a>
                    <a href="dashboard.html" class="dropdown-item">
                        <i class="fas fa-home"></i> Dashboard
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="../Profile/profile.html#settings" class="dropdown-item">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <header class="page-header fade-in-up">
            <h1 class="page-title">Discover book clubs, join discussions, and connect with readers.</h1>
        </header>

        <!-- Explore Genres with Books -->
        <section class="section fade-in-up delay-1">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">üé≠</span>
                    Explore Genres
                </h2>
                <a href="#" class="view-all">View all <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="genres-container">
                <button class="scroll-btn scroll-left">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="scroll-btn scroll-right">
                    <i class="fas fa-chevron-right"></i>
                </button>
                <div class="genres-scroll" id="genresScroll">
                    <!-- Genre categories with books will be loaded here -->
                    <div class="loading-genre">
                        <div class="genre-header">
                            <div class="genre-category-icon">üìö</div>
                            <div class="genre-category-name">Loading...</div>
                        </div>
                        <div class="genre-books-container">
                            <div class="genre-book-item">
                                <div style="width: 60px; height: 90px; background: rgba(245, 230, 211, 0.1); border-radius: 8px;"></div>
                                <div style="flex: 1;">
                                    <div style="height: 16px; width: 80%; background: rgba(245, 230, 211, 0.1); border-radius: 4px; margin-bottom: 8px;"></div>
                                    <div style="height: 12px; width: 60%; background: rgba(245, 230, 211, 0.1); border-radius: 4px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Live Voice Rooms -->
        <section class="section fade-in-up delay-2">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">üéôÔ∏è</span>
                    Live Voice Rooms
                </h2>
                <a href="#" class="view-all">See All Rooms <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="voice-rooms-grid" id="voiceRoomsGrid"></div>
        </section>

        <!-- Trending Discussions -->
        <section class="section fade-in-up delay-3">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">üî•</span>
                    Trending Discussions
                </h2>
                <a href="#" class="view-all">Go to Forum <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="discussions-list" id="discussionsList"></div>
        </section>

        <!-- Reader Matches -->
        <section class="section fade-in-up delay-4">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">‚ú®</span>
                    Reader Matches
                </h2>
                <a href="#" class="view-all">Find More Matches <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="matches-list" id="matchesList"></div>
        </section>

        <!-- Suggested Book Clubs -->
        <section class="section fade-in-up delay-5">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">üìö</span>
                    Suggested Book Clubs
                </h2>
                <a href="#" class="view-all">Browse directory <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="clubs-grid" id="clubsGrid"></div>
        </section>

        <!-- NEW: Quick Actions -->
        <section class="section quick-actions-section fade-in-up">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">‚ö°</span>
                    Quick Actions
                </h2>
            </div>
            <div class="quick-actions-grid" id="quickActionsGrid"></div>
        </section>
    </main>

    <script>
        // ===== API CONFIGURATION =====
        const API_BASE_URL = 'http://localhost:5002/api';
        
        // ===== ENHANCED DATA =====
        // More genres added
        const genres = [
            { name: 'Fantasy', icon: 'üßô' },
            { name: 'Mystery', icon: 'üîç' },
            { name: 'Romance', icon: 'üíñ' },
            { name: 'Sci-Fi', icon: 'üöÄ' },
            { name: 'Horror', icon: 'üëª' },
            { name: 'Thriller', icon: 'üî™' },
            { name: 'Biography', icon: 'üìñ' },
            { name: 'History', icon: 'üèõÔ∏è' },
            { name: 'Poetry', icon: '‚úíÔ∏è' },
            { name: 'Classics', icon: 'üìú' },
            { name: 'Young Adult', icon: 'üë¶' },
            { name: 'Graphic Novels', icon: 'üñºÔ∏è' },
            { name: 'Non-Fiction', icon: 'üìö' },
            { name: 'Self-Help', icon: 'üí™' },
            { name: 'Business', icon: 'üíº' },
            { name: 'Science', icon: 'üî¨' }
        ];

        // Voice Rooms data
        const voiceRooms = [
            {
                host: 'Sarah Chen',
                hostInitials: 'SC',
                title: 'Women Who Read: Weekly Talk',
                genre: 'General Fiction',
                book: 'Tuesdays with Morrie',
                listeners: 7,
                capacity: 20
            },
            {
                host: 'Book Nerds',
                hostInitials: 'BN',
                title: 'Fantasy Chapter 3 Breakdown',
                genre: 'Spoilers',
                book: 'The Hobbit',
                listeners: 4,
                capacity: 10
            },
            {
                host: 'John Miller',
                hostInitials: 'JM',
                title: 'Night Owl Reading Room',
                genre: 'Chill Vibes',
                book: 'Reading Hour',
                listeners: 12,
                capacity: 40
            }
        ];

        // Discussions data
        const discussions = [
            {
                author: 'Sarah H.',
                authorInitials: 'SH',
                time: '2h ago',
                category: 'General Discussion',
                title: 'I Just Finished The Silent Patient and I am SCREAMING',
                excerpt: 'Okay. I need to rant about this book. I feel like it had the world about the story I think I feel like I was cheated a little. I stayed up reading this...',
                comments: 38,
                likes: 128,
                shares: 0
            },
            {
                author: 'Marta R.',
                authorInitials: 'MR',
                time: '4h ago',
                category: 'Different Mends',
                title: 'Unpopular Opinion: The Seven Husbands of Evelyn Hugo',
                excerpt: "Everybody raves it, but for me, I felt it was a bit slow. I think I had too high expectations (blame all the TikTok's) and didn't find my loving in this one. It think I have no...",
                comments: 73,
                likes: 367,
                shares: 0
            }
        ];

        // Matches data (fallback)
        const matches = [
            {
                name: 'AlexReads02',
                initials: 'AR',
                score: '91% Match',
                genres: 'Likes: Sci-Fi, Fantasy, Dystopia'
            },
            {
                name: 'BookwormBella',
                initials: 'BB',
                score: '87% Match',
                genres: 'Likes: Romance, Mystery, Fantasy'
            }
        ];

        // Book Clubs data
        const clubs = [
            {
                icon: 'üìñ',
                name: 'Cozy Readers Group',
                description: 'A cozy place for those who love reading with fun and delicious books. No pressure, just feels.',
                currentBook: 'Anxious People',
                members: 156
            },
            {
                icon: 'üìö',
                name: 'Thriller Lovers Circle',
                description: 'We explore the darkest plot twists and most nail-biting twists. Weekly discussions on Friday.',
                currentBook: 'We Remember',
                members: 92
            }
        ];

        // Quick Actions data
        const quickActions = [
            {
                icon: 'üéôÔ∏è',
                title: 'View Voice Rooms',
                description: 'Browse and join live voice discussions happening right now.',
                action: 'viewVoiceRooms'
            },
            {
                icon: 'üí¨',
                title: 'Discussion Board',
                description: 'See trending discussions and join the conversation.',
                action: 'viewDiscussions'
            },
            {
                icon: '‚ú®',
                title: 'Find Matches',
                description: 'Discover readers with similar tastes and connect.',
                action: 'findMatches'
            },
            {
                icon: 'üìö',
                title: 'Book Clubs',
                description: 'Browse all book clubs and join communities.',
                action: 'viewClubs'
            },
            {
                icon: 'üéØ',
                title: 'Start Discussion',
                description: 'Create a new discussion topic and engage readers.',
                action: 'startDiscussion'
            },
            {
                icon: 'üë•',
                title: 'Create Club',
                description: 'Start your own book club and build a community.',
                action: 'createClub'
            }
        ];

        // ===== AUTHENTICATION CHECK =====
        function checkAuth() {
            const token = localStorage.getItem('litlink_token');
            const user = JSON.parse(localStorage.getItem('litlink_user') || 'null');
            
            if (!token || !user) {
                console.log('‚ùå No authentication found, redirecting to login...');
                window.location.href = '../Homepage/index.html';
                return null;
            }
            
            console.log('‚úÖ User authenticated:', user.name || user.email);
            return { token, user };
        }

// ===== USER DATA INTEGRATION =====
async function loadUserData() {
    try {
        const auth = checkAuth();
        if (!auth) return;
        
        const { token, user } = auth;
        
        console.log('Loading user data for:', user.email);
        
        // Update header with real user data
        const userAvatar = document.querySelector('.user-avatar');
        const userName = document.querySelector('.user-name');
        
        if (userAvatar) {
            // Use first letters of name for avatar
            const initials = user.name ? user.name.split(' ').map(n => n[0]).join('').toUpperCase() : 'U';
            userAvatar.textContent = initials;
            
            // Add random gradient
            const colors = [
                ['#667eea', '#764ba2'],
                ['#f093fb', '#f5576c'],
                ['#4ecdc4', '#44a08d'],
                ['#ff6b6b', '#ee5a52'],
                ['#8b5cf6', '#7c3aed']
            ];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            userAvatar.style.background = `linear-gradient(135deg, ${randomColor[0]} 0%, ${randomColor[1]} 100%)`;
            
            // Set profile picture if available
            if (user.profilePicture) {
                userAvatar.style.backgroundImage = `url(${user.profilePicture})`;
                userAvatar.style.backgroundSize = 'cover';
                userAvatar.style.backgroundPosition = 'center';
                userAvatar.textContent = '';
            }
        }
        
        if (userName) {
            userName.textContent = user.name || user.email.split('@')[0];
        }
        
        // Load genre books
        await loadGenreBooks(token);
        
        // Load dashboard data for recommendations
        const userId = user.id || user._id;
        if (userId) {
            await loadDashboardData(userId, token);
        }
        
        console.log('‚úÖ User data loaded successfully');
        
    } catch (error) {
        console.error('Error loading user data:', error);
        // Load fallback content even if there's an error
        generateVoiceRooms();
        generateDiscussions();
        generateMatches();
        generateBookClubs();
        generateQuickActions();
    }
}

// ===== DASHBOARD DATA LOADING =====
async function loadDashboardData(userId, token) {
    try {
        console.log('Loading dashboard data for user:', userId);
        
        // Try to load user-specific data for recommendations
        const [matchesResponse, clubsResponse] = await Promise.allSettled([
            fetch(`${API_BASE_URL}/users/${userId}/matches`, {
                headers: { 'Authorization': `Bearer ${token}` }
            }).catch(() => ({ ok: false })), // Handle fetch errors
            fetch(`${API_BASE_URL}/users/${userId}/clubs`, {
                headers: { 'Authorization': `Bearer ${token}` }
            }).catch(() => ({ ok: false })) // Handle fetch errors
        ]);
        
        console.log('Matches response status:', matchesResponse.status);
        console.log('Clubs response status:', clubsResponse.status);
        
        // Handle matches data - only if endpoint exists
        if (matchesResponse.status === 'fulfilled' && matchesResponse.value.ok) {
            try {
                const matchesData = await matchesResponse.value.json();
                if (matchesData.success && matchesData.matches && matchesData.matches.length > 0) {
                    console.log('Loaded real matches:', matchesData.matches.length);
                    updateMatchesWithRealData(matchesData.matches);
                    return; // Skip fallback if we have real data
                }
            } catch (error) {
                console.log('Could not parse matches data:', error.message);
            }
        } else {
            console.log('Matches endpoint not available or returned error');
        }
        
        // Handle clubs data - only if endpoint exists
        if (clubsResponse.status === 'fulfilled' && clubsResponse.value.ok) {
            try {
                const clubsData = await clubsResponse.value.json();
                if (clubsData.success && clubsData.clubs && clubsData.clubs.length > 0) {
                    console.log('Loaded real clubs:', clubsData.clubs.length);
                    updateClubsWithRealData(clubsData.clubs);
                    return; // Skip fallback if we have real data
                }
            } catch (error) {
                console.log('Could not parse clubs data:', error.message);
            }
        } else {
            console.log('Clubs endpoint not available or returned error');
        }
        
        // If we reach here, use fallback data
        console.log('Using fallback matches and clubs data');
        generateMatches();
        generateBookClubs();
        
    } catch (error) {
        console.error('Error loading dashboard data:', error);
        // Use fallback data
        generateMatches();
        generateBookClubs();
    }
}

        function updateMatchesWithRealData(realMatches) {
            const container = document.getElementById('matchesList');
            if (!container || !realMatches || realMatches.length === 0) return;
            
            container.innerHTML = '';
            
            realMatches.slice(0, 4).forEach(match => {
                const card = document.createElement('div');
                card.className = 'match-card';
                
                // Generate initials from name
                const initials = match.name ? match.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2) : 'UR';
                
                card.innerHTML = `
                    <div class="match-avatar">${initials}</div>
                    <div class="match-score">${match.matchScore || Math.floor(Math.random() * 20) + 80}% Match</div>
                    <div class="match-name">${match.name || 'Unknown User'}</div>
                    <div class="match-genres">Likes: ${match.favoriteGenres ? match.favoriteGenres.slice(0, 3).join(', ') : 'Various genres'}</div>
                    <button class="match-btn" data-user-id="${match.id || match._id}" data-user-name="${match.name || 'User'}">
                        Connect
                    </button>
                `;
                container.appendChild(card);
            });
        }

        function updateClubsWithRealData(realClubs) {
            const container = document.getElementById('clubsGrid');
            if (!container || !realClubs || realClubs.length === 0) return;
            
            container.innerHTML = '';
            
            realClubs.slice(0, 2).forEach(club => {
                const card = document.createElement('div');
                card.className = 'club-card';
                
                // Determine icon based on club name or category
                const icons = ['üìñ', 'üìö', 'üë•', 'üí¨', 'üî•', '‚ú®'];
                const randomIcon = icons[Math.floor(Math.random() * icons.length)];
                
                card.innerHTML = `
                    <div class="club-banner">${club.icon || randomIcon}</div>
                    <div class="club-content">
                        <h3 class="club-title">${club.name || 'Book Club'}</h3>
                        <p class="club-description">${club.description || 'A community of passionate readers.'}</p>
                        <div class="club-current-book">üìñ ${club.currentBook || 'Currently reading together'}</div>
                        <div class="club-stats">
                            <div class="club-stat">
                                <i class="fas fa-users"></i>
                                <span>${club.memberCount || club.members?.length || '50'} members</span>
                            </div>
                            <div class="club-stat">
                                <i class="fas fa-comments"></i>
                                <span>Active weekly</span>
                            </div>
                        </div>
                        <button class="club-join-btn" data-club-id="${club.id || club._id}">Join Club</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // ===== GENRE BOOKS FUNCTIONALITY =====
        async function loadGenreBooks(token) {
            try {
                const genresScroll = document.getElementById('genresScroll');
                if (!genresScroll) {
                    console.warn('genresScroll container not found');
                    return;
                }
                
                genresScroll.innerHTML = '<div class="loading-genre"><div class="genre-header"><div class="genre-category-icon">üìö</div><div class="genre-category-name">Loading books...</div></div></div>';
                
                // Load books for first 5 genres - only 1 book initially
                const genresToLoad = ['Fantasy', 'Mystery', 'Romance', 'Sci-Fi', 'Horror'];
                
                const loadPromises = genresToLoad.map(async (genre) => {
                    try {
                        const response = await fetch(`${API_BASE_URL}/books/popular/${genre}?limit=1`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            },
                            signal: AbortSignal.timeout(10000) // 10 second timeout
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.success && data.books && data.books.length > 0) {
                                createGenreCategory(genre, data.books.slice(0, 1), data.total_results || 0);
                                return true;
                            } else {
                                createFallbackGenreCategory(genre);
                                return false;
                            }
                        } else {
                            console.log(`Failed to load ${genre} books: HTTP ${response.status}`);
                            createFallbackGenreCategory(genre);
                            return false;
                        }
                    } catch (error) {
                        if (error.name === 'AbortError') {
                            console.log(`Timeout loading ${genre} books`);
                        } else {
                            console.log(`Could not load ${genre} books:`, error.message);
                        }
                        createFallbackGenreCategory(genre);
                        return false;
                    }
                });
                
                // Wait for all genre loads to complete
                await Promise.allSettled(loadPromises);
                
                // Remove loading indicator
                const loadingIndicator = genresScroll.querySelector('.loading-genre');
                if (loadingIndicator) {
                    loadingIndicator.remove();
                }
                
                console.log('‚úÖ Genre books loading completed');
                
            } catch (error) {
                console.error('Error loading genre books:', error);
                const genresScroll = document.getElementById('genresScroll');
                if (genresScroll) {
                    genresScroll.innerHTML = '<div class="loading-genre"><div class="genre-header"><div class="genre-category-icon">üìö</div><div class="genre-category-name">Error loading books. Please refresh.</div></div></div>';
                }
            }
        }

function createGenreCategory(genreName, books, totalCount = 0) {
    const genresScroll = document.getElementById('genresScroll');
    
    const genreCategory = document.createElement('div');
    genreCategory.className = 'genre-category';
    genreCategory.dataset.genre = genreName.toLowerCase();
    genreCategory.dataset.totalCount = totalCount;
    
    // Get icon for this genre
    const genreInfo = genres.find(g => g.name === genreName);
    const genreIcon = genreInfo ? genreInfo.icon : 'üìö';
    
    // Only show first book initially (preview style)
    const previewBook = books[0];
    if (!previewBook) {
        createFallbackGenreCategory(genreName);
        return;
    }
    
    const shortDescription = previewBook.description 
        ? (previewBook.description.length > 100 ? previewBook.description.substring(0, 100) + '...' : previewBook.description)
            : 'No description available';
        
    const coverUrl = previewBook.cover || `https://placehold.co/60x90/3d2617/f5e6d3?text=${encodeURIComponent(previewBook.title.substring(0, 10))}&font=montserrat`;
    
    genreCategory.innerHTML = `
        <div class="genre-header">
            <div class="genre-category-icon">${genreIcon}</div>
            <div class="genre-category-name">${genreName}</div>
            ${totalCount > 0 ? `<span style="color: #d4b5a0; font-size: 0.85rem; margin-left: auto;">${totalCount} books</span>` : ''}
        </div>
        <div class="genre-books-container" style="max-height: 140px;">
            <div class="genre-book-item preview-book" data-book-id="${previewBook.id}" data-book-title="${previewBook.title.replace(/"/g, '&quot;')}" style="cursor: pointer;">
                <img src="${coverUrl}" alt="${previewBook.title}" class="genre-book-cover" 
                     onerror="this.src='https://placehold.co/60x90/3d2617/f5e6d3?text=Book&font=montserrat'">
                <div class="genre-book-info">
                    <div class="genre-book-title">${previewBook.title}</div>
                    <div class="genre-book-author">${previewBook.authors?.[0] || 'Unknown Author'}</div>
                    <div class="genre-book-description">${shortDescription}</div>
        </div>
            </div>
        </div>
        <button class="genre-action-btn" onclick="loadFullGenreList('${genreName}')" style="margin-top: 15px;">
            <i class="fas fa-chevron-right"></i> View All ${genreName} Books
        </button>
    `;
    
    genresScroll.appendChild(genreCategory);
    
    // Add click event to preview book
    const bookItem = genreCategory.querySelector('.preview-book');
    bookItem.addEventListener('click', function(e) {
            e.stopPropagation();
            const bookId = this.dataset.bookId;
            const bookTitle = this.dataset.bookTitle;
        showBookDetailsModal(bookId, bookTitle);
    });
}

        function createFallbackGenreCategory(genreName) {
            const genresScroll = document.getElementById('genresScroll');
            
            const genreCategory = document.createElement('div');
            genreCategory.className = 'genre-category';
            genreCategory.dataset.genre = genreName.toLowerCase();
            
            // Get icon for this genre
            const genreInfo = genres.find(g => g.name === genreName);
            const genreIcon = genreInfo ? genreInfo.icon : 'üìö';
            
            genreCategory.innerHTML = `
                <div class="genre-header">
                    <div class="genre-category-icon">${genreIcon}</div>
                    <div class="genre-category-name">${genreName}</div>
                </div>
                <div class="genre-books-container">
                    <div class="genre-book-item">
                        <div style="width: 60px; height: 90px; background: rgba(245, 230, 211, 0.1); border-radius: 8px;"></div>
                        <div style="flex: 1;">
                            <div class="genre-book-title">Popular ${genreName} Title</div>
                            <div class="genre-book-author">Famous Author</div>
                            <div class="genre-book-description">Explore amazing ${genreName.toLowerCase()} stories</div>
                        </div>
                    </div>
                </div>
                <button class="genre-action-btn" onclick="showMoreGenreBooks('${genreName}')">
                    Explore ${genreName} Books
                </button>
            `;
            
            genresScroll.appendChild(genreCategory);
        }

        // Load full genre list (200+ books)
        async function loadFullGenreList(genreName) {
            try {
                const auth = checkAuth();
                if (!auth) return;
                
                const { token } = auth;
                
                // Show loading state
                const genreCategory = document.querySelector(`[data-genre="${genreName.toLowerCase()}"]`);
                if (!genreCategory) return;
                
                const actionBtn = genreCategory.querySelector('.genre-action-btn');
                actionBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                actionBtn.disabled = true;
                
                // Load up to 200 books
                const response = await fetch(`${API_BASE_URL}/books/popular/${genreName}?limit=200&page=1`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.books.length > 0) {
                        displayFullGenreList(genreCategory, genreName, data.books);
                    } else {
                        actionBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> No books found';
                        setTimeout(() => {
                            actionBtn.innerHTML = `<i class="fas fa-chevron-right"></i> View All ${genreName} Books`;
                            actionBtn.disabled = false;
                        }, 2000);
                    }
                }
            } catch (error) {
                console.error('Error loading full genre list:', error);
                showMessageModal('Error', `Could not load ${genreName} books at the moment. Please try again later.`, 'error');
                const actionBtn = genreCategory.querySelector('.genre-action-btn');
                actionBtn.innerHTML = `<i class="fas fa-chevron-right"></i> View All ${genreName} Books`;
                actionBtn.disabled = false;
            }
        }
        
        function displayFullGenreList(genreCategory, genreName, books) {
            const booksContainer = genreCategory.querySelector('.genre-books-container');
            const actionBtn = genreCategory.querySelector('.genre-action-btn');
            
            // Clear preview book
            booksContainer.innerHTML = '';
            booksContainer.style.maxHeight = '400px';
            booksContainer.style.overflowY = 'auto';
            
            // Display all books
            books.forEach(book => {
                const shortDescription = book.description 
                    ? (book.description.length > 80 ? book.description.substring(0, 80) + '...' : book.description)
                    : 'No description available';
                
                const coverUrl = book.cover || `https://placehold.co/60x90/3d2617/f5e6d3?text=${encodeURIComponent(book.title.substring(0, 10))}&font=montserrat`;
                
                const bookItem = document.createElement('div');
                bookItem.className = 'genre-book-item';
                bookItem.dataset.bookId = book.id;
                bookItem.dataset.bookTitle = book.title.replace(/"/g, '&quot;');
                bookItem.style.cursor = 'pointer';
                
                bookItem.innerHTML = `
                    <img src="${coverUrl}" alt="${book.title}" class="genre-book-cover" 
                         onerror="this.src='https://placehold.co/60x90/3d2617/f5e6d3?text=Book&font=montserrat'">
                    <div class="genre-book-info">
                        <div class="genre-book-title">${book.title}</div>
                        <div class="genre-book-author">${book.authors?.[0] || 'Unknown Author'}</div>
                        <div class="genre-book-description">${shortDescription}</div>
                    </div>
                `;
                
                bookItem.addEventListener('click', function() {
                    showBookDetailsModal(book.id, book.title);
                });
                
                booksContainer.appendChild(bookItem);
            });
            
            // Update button
            actionBtn.innerHTML = `<i class="fas fa-check"></i> Showing ${books.length} ${genreName} Books`;
            actionBtn.style.background = 'rgba(16, 185, 129, 0.1)';
            actionBtn.style.borderColor = 'rgba(16, 185, 129, 0.3)';
        }
        
        // Show more genre books - wrapper function for fallback genre categories
        async function showMoreGenreBooks(genreName) {
            try {
                const auth = checkAuth();
                if (!auth) return;
                
                const { token } = auth;
                
                // Find the genre category element
                const genreCategory = document.querySelector(`[data-genre="${genreName.toLowerCase()}"]`);
                if (!genreCategory) {
                    console.error(`Genre category not found: ${genreName}`);
                    return;
                }
                
                // Use the same logic as loadFullGenreList
                await loadFullGenreList(genreName);
            } catch (error) {
                console.error(`Error showing more ${genreName} books:`, error);
                showMessageModal('Error', `Could not load ${genreName} books at the moment. Please try again later.`, 'error');
            }
        }
        
        // Comprehensive book details modal
        async function showBookDetailsModal(bookId, bookTitle) {
            const auth = checkAuth();
            if (!auth) return;
            
            const { token } = auth;
            
            // Remove any existing modals
            const existingModal = document.getElementById('bookDetailModal');
            if (existingModal) existingModal.remove();
            
            // Create loading modal
            const loadingModal = document.createElement('div');
            loadingModal.id = 'bookDetailModal';
            loadingModal.className = 'book-detail-modal';
            loadingModal.innerHTML = `
                <div class="book-detail-overlay"></div>
                <div class="book-detail-content">
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #d4b5a0;"></i>
                        <p style="color: #d4b5a0; margin-top: 15px;">Loading book details...</p>
                        </div>
                </div>
            `;
            document.body.appendChild(loadingModal);
            
            try {
                // Fetch comprehensive book details
                const response = await fetch(`${API_BASE_URL}/books/details/${bookId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                let bookData = null;
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.book) {
                        bookData = data.book;
                    }
                }
                
                // If details fetch failed, try to get basic info
                if (!bookData) {
                    bookData = {
                        id: bookId,
                        title: bookTitle,
                        description: 'Loading description...',
                        cover: null,
                        authors: [{ name: 'Unknown Author' }],
                        firstPublishDate: null,
                        publishers: [],
                        isbn10: null,
                        isbn13: null,
                        numberOfPages: null,
                        subjects: [],
                        ratings: { average: null, count: 0 }
                    };
                }
                
                // Render full book detail modal
                renderBookDetailModal(bookData);
                
            } catch (error) {
                console.error('Error loading book details:', error);
                loadingModal.remove();
                showMessageModal('Error', 'Could not load book details. Please try again.', 'error');
            }
        }
        
        function renderBookDetailModal(book) {
            const modal = document.getElementById('bookDetailModal');
            if (!modal) return;
            
            const description = book.description || 'No description available.';
            const isDescriptionLong = description.length > 300;
            const shortDescription = isDescriptionLong ? description.substring(0, 300) + '...' : description;
            
            const coverUrl = book.cover || `https://placehold.co/200x300/3d2617/f5e6d3?text=${encodeURIComponent(book.title.substring(0, 15))}&font=montserrat`;
            
            modal.innerHTML = `
                <div class="book-detail-overlay" onclick="closeBookDetailModal()"></div>
                <div class="book-detail-content">
                    <button class="book-detail-close" onclick="closeBookDetailModal()">&times;</button>
                    
                    <div class="book-detail-main">
                        <div class="book-detail-cover">
                            <img src="${coverUrl}" alt="${book.title}" 
                                 onerror="this.src='https://placehold.co/200x300/3d2617/f5e6d3?text=Book&font=montserrat'">
                        </div>
                        
                        <div class="book-detail-info">
                            <h1 class="book-detail-title">${book.title}</h1>
                            
                            <div class="book-detail-authors">
                                ${book.authors.map(author => `
                                    <div class="book-author-item">
                                        <strong>${author.name}</strong>
                                        ${author.bio ? `<p class="author-bio">${author.bio.substring(0, 150)}...</p>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="book-detail-description">
                                <h3>Description</h3>
                                <p id="bookDescription">${shortDescription}</p>
                                ${isDescriptionLong ? `
                                    <button onclick="toggleDescription()" class="toggle-description-btn">
                                        <span id="descToggle">Show More</span>
                            </button>
                                ` : ''}
                            </div>
                            
                            <div class="book-detail-meta">
                                <h3>Publication Details</h3>
                                <table class="book-meta-table">
                                    ${book.firstPublishDate ? `<tr><td>First Published:</td><td>${book.firstPublishDate}</td></tr>` : ''}
                                    ${book.publishers && book.publishers.length > 0 ? `<tr><td>Publisher:</td><td>${book.publishers[0]}</td></tr>` : ''}
                                    ${book.isbn13 ? `<tr><td>ISBN-13:</td><td>${book.isbn13}</td></tr>` : ''}
                                    ${book.isbn10 ? `<tr><td>ISBN-10:</td><td>${book.isbn10}</td></tr>` : ''}
                                    ${book.numberOfPages ? `<tr><td>Pages:</td><td>${book.numberOfPages}</td></tr>` : ''}
                                    ${book.ratings?.average ? `<tr><td>Rating:</td><td>${book.ratings.average}/5 (${book.ratings.count} ratings)</td></tr>` : ''}
                                </table>
                            </div>
                            
                            ${book.subjects && book.subjects.length > 0 ? `
                                <div class="book-detail-genres">
                                    <h3>Genres</h3>
                                    <div class="genre-tags">
                                        ${book.subjects.slice(0, 5).map(subject => `
                                            <span class="genre-tag">${typeof subject === 'string' ? subject : subject.name || 'Genre'}</span>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="book-detail-actions">
                                <button class="action-btn primary" onclick="addBookToFavorites('${book.id}', '${book.title.replace(/'/g, "\\'")}')">
                                    <i class="fas fa-heart"></i> Add to Favorites
                                </button>
                                <button class="action-btn secondary" onclick="findSimilarBooks('${book.id}')">
                                    <i class="fas fa-search"></i> Find Similar
                                </button>
                                <button class="action-btn secondary" onclick="shareBook('${book.id}', '${book.title.replace(/'/g, "\\'")}')">
                                    <i class="fas fa-share"></i> Share
                            </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Store full description
            if (isDescriptionLong) {
                window.fullBookDescription = book.description;
                window.showFullDescription = false;
            }
        }
        
        function toggleDescription() {
            const descEl = document.getElementById('bookDescription');
            const toggleEl = document.getElementById('descToggle');
            
            if (window.showFullDescription) {
                descEl.textContent = window.fullBookDescription.substring(0, 300) + '...';
                toggleEl.textContent = 'Show More';
                window.showFullDescription = false;
            } else {
                descEl.textContent = window.fullBookDescription;
                toggleEl.textContent = 'Show Less';
                window.showFullDescription = true;
            }
        }
        
        function closeBookDetailModal() {
            const modal = document.getElementById('bookDetailModal');
            if (modal) modal.remove();
        }
        
        function findSimilarBooks(bookId) {
            showMessageModal('Coming Soon', 'Finding similar books feature coming soon!', 'info');
        }
        
        function shareBook(bookId, bookTitle) {
            const url = window.location.href;
            if (navigator.share) {
                navigator.share({
                    title: bookTitle,
                    text: `Check out "${bookTitle}" on Litlink!`,
                    url: url
                });
            } else {
                navigator.clipboard.writeText(`${bookTitle} - ${url}`);
                showMessageModal('Success', 'Book link copied to clipboard!', 'success');
            }
        }

        async function addBookToFavorites(bookId, bookTitle) {
            try {
                const auth = checkAuth();
                if (!auth) return;
                
                const { token, user } = auth;
                const userId = user.id || user._id;
                
                // Add to user's profile books
                const response = await fetch(`${API_BASE_URL}/users/${userId}/books`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bookId: bookId,
                        bookTitle: bookTitle
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.style.cssText = `
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        background: #10b981;
                        color: white;
                        padding: 15px 25px;
                        border-radius: 10px;
                        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
                        z-index: 10002;
                        animation: fadeInUp 0.3s ease;
                    `;
                    successMsg.innerHTML = `<i class="fas fa-check"></i> "${bookTitle}" added to your profile!`;
                    document.body.appendChild(successMsg);
                    
                    setTimeout(() => {
                        successMsg.style.animation = 'fadeOut 0.3s ease';
                        setTimeout(() => successMsg.remove(), 300);
                    }, 3000);
                } else {
                    showMessageModal('Error', data.message || 'Failed to add book', 'error');
                }
            } catch (error) {
                console.error('Error adding book to favorites:', error);
                showMessageModal('Error', 'Failed to add book to favorites', 'error');
            }
        }

        // ===== INTERACTION HANDLERS =====
        function setupConnectButtons() {
            document.addEventListener('click', async function(e) {
                if (e.target.classList.contains('match-btn')) {
                    e.stopPropagation();
                    const userId = e.target.dataset.userId;
                    const userName = e.target.dataset.userName || 'User';
                    
                    if (e.target.textContent === 'Connect') {
                        try {
                            const token = localStorage.getItem('litlink_token');
                            
                            console.log(`Connecting with user ${userId}...`);
                            
                            // Simulate API call (replace with real API)
                            setTimeout(() => {
                                e.target.textContent = 'Connected';
                                e.target.disabled = true;
                                e.target.innerHTML = 'Connected <i class="fas fa-check"></i>';
                                showMessageModal('Success', `Connected with ${userName}!`, 'success');
                            }, 500);
                            
                        } catch (error) {
                            console.error('Connection error:', error);
                            showMessageModal('Error', 'Failed to connect. Please try again.', 'error');
                        }
                    }
                }
            });
        }

        // Setup join room handlers
        function setupRoomJoinButtons() {
            document.addEventListener('click', async function(e) {
                if (e.target.classList.contains('room-join-btn')) {
                    e.stopPropagation();
                    const roomTitle = e.target.closest('.voice-room-card').querySelector('.room-title').textContent;
                    
                    const token = localStorage.getItem('litlink_token');
                    if (!token) {
                        showMessageModal('Login Required', 'Please login first', 'warning');
                        return;
                    }
                    
                    // Simulate joining
                    showMessageModal('Joining Room', `Joining voice room: ${roomTitle}`, 'info');
                    
                    // Update button state
                    e.target.textContent = 'Joined';
                    e.target.disabled = true;
                    e.target.innerHTML = '<i class="fas fa-check"></i> Joined';
                }
            });
        }

        // Setup join club handlers
        function setupClubJoinButtons() {
            document.addEventListener('click', async function(e) {
                if (e.target.classList.contains('club-join-btn')) {
                    e.stopPropagation();
                    const clubName = e.target.closest('.club-card').querySelector('.club-title').textContent;
                    
                    const token = localStorage.getItem('litlink_token');
                    if (!token) {
                        showMessageModal('Login Required', 'Please login first', 'warning');
                        return;
                    }
                    
                    // Simulate API call
                    showMessageModal('Joining Club', `Joining book club: ${clubName}`, 'info');
                    
                    // Update button state
                    e.target.textContent = 'Joined';
                    e.target.disabled = true;
                    e.target.innerHTML = 'Joined <i class="fas fa-check"></i>';
                }
            });
        }

        function handleQuickAction(action) {
            const actions = {
                'viewVoiceRooms': () => {
                    const voiceRoomsSection = document.querySelector('.voice-rooms-grid').closest('.section');
                    voiceRoomsSection.scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                },
                'viewDiscussions': () => {
                    const discussionsSection = document.querySelector('.discussions-list').closest('.section');
                    discussionsSection.scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                },
                'findMatches': () => {
                    const matchesSection = document.querySelector('.matches-list').closest('.section');
                    matchesSection.scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                },
                'viewClubs': () => {
                    const clubsSection = document.querySelector('.clubs-grid').closest('.section');
                    clubsSection.scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                },
                'startDiscussion': () => {
                    showMessageModal('Coming Soon', 'Opening discussion creator...', 'info');
                },
                'createClub': () => {
                    showMessageModal('Coming Soon', 'Opening club creator...', 'info');
                }
            };
            
            if (actions[action]) {
                actions[action]();
            }
        }

        // ===== CONTENT GENERATION FUNCTIONS =====
        function generateVoiceRooms() {
            const container = document.getElementById('voiceRoomsGrid');
            if (!container) return;
            
            voiceRooms.forEach(room => {
                const card = document.createElement('div');
                card.className = 'voice-room-card';
                card.innerHTML = `
                    <div class="room-header">
                        <div class="room-host-avatar">${room.hostInitials}</div>
                        <div class="room-info">
                            <div class="room-live-badge">
                                <i class="fas fa-circle"></i>
                                LIVE ‚Ä¢ ${room.listeners} listening
                            </div>
                            <div class="room-title">${room.title}</div>
                        </div>
                    </div>
                    <div class="room-meta">
                        <span><i class="fas fa-user"></i> ${room.host}</span>
                        <span><i class="fas fa-book"></i> ${room.book}</span>
                    </div>
                    <div class="room-participants">
                        <div class="participants-avatars">
                            <div class="participant-avatar">${room.hostInitials[0]}</div>
                            ${room.listeners > 1 ? '<div class="participant-avatar">' + room.listeners + '</div>' : ''}
                        </div>
                        <span class="participants-count">${room.listeners} / ${room.capacity}</span>
                    </div>
                    <button class="room-join-btn">
                        <i class="fas fa-microphone"></i>
                        Join Room
                    </button>
                `;
                container.appendChild(card);
            });
        }

        function generateDiscussions() {
            const container = document.getElementById('discussionsList');
            if (!container) return;
            
            discussions.forEach(discussion => {
                const card = document.createElement('div');
                card.className = 'discussion-card';
                card.innerHTML = `
                    <div class="discussion-header">
                        <div class="discussion-avatar">${discussion.authorInitials}</div>
                        <div class="discussion-user-info">
                            <div class="discussion-author">${discussion.author}</div>
                            <div class="discussion-time">
                                <i class="far fa-clock"></i>
                                ${discussion.time} ‚Ä¢ ${discussion.category}
                            </div>
                        </div>
                    </div>
                    <h3 class="discussion-title">${discussion.title}</h3>
                    <p class="discussion-excerpt">${discussion.excerpt}</p>
                    <div class="discussion-stats">
                        <div class="discussion-stat">
                            <i class="fas fa-comment"></i>
                            <span>${discussion.comments} comments</span>
                        </div>
                        <div class="discussion-stat">
                            <i class="fas fa-arrow-up"></i>
                            <span>${discussion.likes}</span>
                        </div>
                        <div class="discussion-stat">
                            <i class="fas fa-share"></i>
                            <span>Share</span>
                        </div>
                    </div>
                `;
                card.addEventListener('click', () => {
                    console.log(`Opening discussion: ${discussion.title}`);
                    showMessageModal('Loading', `Loading discussion: "${discussion.title}"`, 'info');
                });
                container.appendChild(card);
            });
        }

        function generateMatches() {
            const container = document.getElementById('matchesList');
            if (!container) return;
            
            matches.forEach(match => {
                const card = document.createElement('div');
                card.className = 'match-card';
                card.innerHTML = `
                    <div class="match-avatar">${match.initials}</div>
                    <div class="match-score">${match.score}</div>
                    <div class="match-name">${match.name}</div>
                    <div class="match-genres">${match.genres}</div>
                    <button class="match-btn" data-user-name="${match.name}">
                        Connect
                    </button>
                `;
                container.appendChild(card);
            });
        }

        function generateBookClubs() {
            const container = document.getElementById('clubsGrid');
            if (!container) return;
            
            clubs.forEach(club => {
                const card = document.createElement('div');
                card.className = 'club-card';
                card.innerHTML = `
                    <div class="club-banner">${club.icon}</div>
                    <div class="club-content">
                        <h3 class="club-title">${club.name}</h3>
                        <p class="club-description">${club.description}</p>
                        <div class="club-current-book">üìñ ${club.currentBook}</div>
                        <div class="club-stats">
                            <div class="club-stat">
                                <i class="fas fa-users"></i>
                                <span>${club.members} members</span>
                            </div>
                            <div class="club-stat">
                                <i class="fas fa-comments"></i>
                                <span>Active weekly</span>
                            </div>
                        </div>
                        <button class="club-join-btn">Join Club</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function generateQuickActions() {
            const container = document.getElementById('quickActionsGrid');
            if (!container) return;
            
            quickActions.forEach(action => {
                const card = document.createElement('div');
                card.className = 'quick-action-card';
                card.innerHTML = `
                    <div class="quick-action-icon">${action.icon}</div>
                    <h3>${action.title}</h3>
                    <p>${action.description}</p>
                    <button class="quick-action-btn" data-action="${action.action}">
                        Go Now
                    </button>
                `;
                card.querySelector('.quick-action-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleQuickAction(action.action);
                });
                container.appendChild(card);
            });
        }

        // ===== FIXED SEARCH FUNCTIONALITY =====
        function setupSearch() {
            const searchInput = document.getElementById('dashSearchInput');
            if (!searchInput) {
                console.warn('Search input not found');
                return;
            }
            let searchTimeout;
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const query = this.value.trim();
                    if (query.length >= 2) {
                        performDashboardSearch(query);
                    }
                }
            });
            
            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                if (query.length >= 3) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        performDashboardSearch(query);
                    }, 500);
                }
            });
        }

        async function performDashboardSearch(query) {
            try {
                const auth = checkAuth();
                if (!auth) return;
                
                const { token } = auth;
                
                console.log('Searching for:', query);
                
                const response = await fetch(`${API_BASE_URL}/books/search?query=${encodeURIComponent(query)}&limit=8`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Search response:', data);
                    
                    if (data.success && data.books) {
                        // Show results even if empty - showSearchResults handles empty state
                        showSearchResults(data.books, query);
                    } else {
                        // If response format is unexpected, try fallback
                        console.warn('Unexpected search response format:', data);
                        // Still show empty results instead of trying fallback
                        showSearchResults([], query);
                    }
                } else {
                    console.error('Search API error:', response.status);
                    const errorText = await response.text().catch(() => '');
                    console.error('Error details:', errorText);
                    // Show empty results instead of fallback
                    showSearchResults([], query);
                }
            } catch (error) {
                console.error('Search error:', error);
                showMessageModal('Search Unavailable', 'Search service unavailable. Please try again later.', 'error');
            }
        }

        async function tryFallbackSearch(query) {
            console.log('Trying fallback search for:', query);
            
            // Simulate fallback search
            setTimeout(() => {
                const fallbackBooks = [
                    {
                        id: 'fallback1',
                        title: `Search results for "${query}"`,
                        authors: ['Try different keywords'],
                        cover: 'https://via.placeholder.com/180x200.png?text=No+Results'
                    },
                    {
                        id: 'fallback2',
                        title: 'Try: Fantasy, Mystery, Romance',
                        authors: ['Popular genres'],
                        cover: 'https://via.placeholder.com/180x200.png?text=Try+Again'
                    }
                ];
                
                showSearchResults(fallbackBooks, query);
            }, 500);
        }

        function showSearchResults(books, query) {
            // Remove existing search results dropdown
            const existingDropdown = document.getElementById('searchResultsDropdown');
            if (existingDropdown) {
                existingDropdown.remove();
            }
            
            // Get search bar container
            const searchBar = document.querySelector('.search-bar');
            if (!searchBar) return;
            
            // Create dropdown container
            const dropdown = document.createElement('div');
            dropdown.id = 'searchResultsDropdown';
            dropdown.className = 'search-results-dropdown show';
            
            if (books.length > 0) {
                dropdown.innerHTML = `
                    <div class="search-results-header">
                        <h4>Found ${books.length} result${books.length !== 1 ? 's' : ''} for "${query}"</h4>
                        <button class="search-results-close" onclick="closeSearchResults()">&times;</button>
                        </div>
                    <div class="search-results-list">
                        ${books.map(book => {
                            const title = (book.title || 'Unknown Title').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                            const author = book.authors ? (Array.isArray(book.authors) ? book.authors[0] : book.authors) : 'Unknown Author';
                            const cover = book.cover || 'https://placehold.co/60x90/3d2617/f5e6d3?text=No+Cover&font=montserrat';
                            return `
                                <div class="search-result-item" onclick="addBookFromSearch('${book.id}', '${title}')">
                                    <img src="${cover}" alt="${title}" class="search-result-cover" 
                                         onerror="this.src='https://placehold.co/60x90/3d2617/f5e6d3?text=Book&font=montserrat'">
                                    <div class="search-result-info">
                                        <div class="search-result-title">${title}</div>
                                        <div class="search-result-author">${author}</div>
                                            </div>
                                            </div>
                            `;
                        }).join('')}
                                        </div>
                `;
            } else {
                dropdown.innerHTML = `
                    <div class="search-results-header">
                        <h4>Search Results</h4>
                        <button class="search-results-close" onclick="closeSearchResults()">&times;</button>
                                    </div>
                    <div class="search-results-empty">
                        <i class="fas fa-book-open"></i>
                        <p>No results found for "${query}"</p>
                        <p style="font-size: 0.85rem; margin-top: 5px;">Try different keywords or browse genres</p>
                            </div>
                `;
            }
            
            // Append to search bar
            searchBar.appendChild(dropdown);
            
            // Close dropdown when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeOnOutsideClick(e) {
                    if (!searchBar.contains(e.target)) {
                        closeSearchResults();
                        document.removeEventListener('click', closeOnOutsideClick);
                    }
                });
            }, 100);
        }
        
        function closeSearchResults() {
            const dropdown = document.getElementById('searchResultsDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
                setTimeout(() => dropdown.remove(), 300);
            }
        }
        
        // ===== CUSTOM MODAL SYSTEM =====
        function showMessageModal(title, message, type = 'info', callback = null) {
            // Remove existing modals
            const existingModal = document.getElementById('customModalOverlay');
            if (existingModal) existingModal.remove();
            
            const icons = {
                info: '<i class="fas fa-info-circle"></i>',
                success: '<i class="fas fa-check-circle"></i>',
                warning: '<i class="fas fa-exclamation-triangle"></i>',
                error: '<i class="fas fa-times-circle"></i>',
                confirm: '<i class="fas fa-question-circle"></i>'
            };
            
            const overlay = document.createElement('div');
            overlay.id = 'customModalOverlay';
            overlay.className = 'custom-modal-overlay';
            
            overlay.innerHTML = `
                <div class="custom-modal">
                    <div class="custom-modal-header">
                        <div class="custom-modal-icon ${type}">
                            ${icons[type] || icons.info}
                            </div>
                        <h3 class="custom-modal-title">${title}</h3>
                        <button class="custom-modal-close" onclick="closeCustomModal()">&times;</button>
                            </div>
                    <div class="custom-modal-body">
                        ${message}
                    </div>
                    <div class="custom-modal-actions">
                        <button class="custom-modal-btn custom-modal-btn-primary" onclick="closeCustomModal(${callback ? 'true' : ''})">OK</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Close on overlay click
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    closeCustomModal(callback);
                }
            });
            
            // Close on Escape key
            const escapeHandler = function(e) {
                if (e.key === 'Escape') {
                    closeCustomModal(callback);
                    document.removeEventListener('keydown', escapeHandler);
                }
            };
            document.addEventListener('keydown', escapeHandler);
        }
        
        function showConfirmModal(title, message, onConfirm, onCancel = null) {
            // Remove existing modals
            const existingModal = document.getElementById('customModalOverlay');
            if (existingModal) existingModal.remove();
            
            const overlay = document.createElement('div');
            overlay.id = 'customModalOverlay';
            overlay.className = 'custom-modal-overlay';
            
            overlay.innerHTML = `
                <div class="custom-modal">
                    <div class="custom-modal-header">
                        <div class="custom-modal-icon confirm">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <h3 class="custom-modal-title">${title}</h3>
                        <button class="custom-modal-close" onclick="closeCustomModal(false)">&times;</button>
                    </div>
                    <div class="custom-modal-body">
                        ${message}
                    </div>
                    <div class="custom-modal-actions">
                        <button class="custom-modal-btn custom-modal-btn-secondary" onclick="closeCustomModal(false)">Cancel</button>
                        <button class="custom-modal-btn custom-modal-btn-primary" onclick="handleConfirm(true)">OK</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Store callbacks
            overlay.dataset.onConfirm = 'true';
            window.__modalOnConfirm = onConfirm;
            window.__modalOnCancel = onCancel;
            
            // Close on overlay click
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    closeCustomModal(false);
                }
            });
            
            // Close on Escape key
            const escapeHandler = function(e) {
                if (e.key === 'Escape') {
                    closeCustomModal(false);
                    document.removeEventListener('keydown', escapeHandler);
                }
            };
            document.addEventListener('keydown', escapeHandler);
        }
        
        function handleConfirm(confirmed) {
            if (confirmed && window.__modalOnConfirm) {
                window.__modalOnConfirm();
            } else if (!confirmed && window.__modalOnCancel) {
                window.__modalOnCancel();
            }
            closeCustomModal(confirmed);
        }
        
        function closeCustomModal(confirmed = null) {
            const overlay = document.getElementById('customModalOverlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    overlay.remove();
                    delete window.__modalOnConfirm;
                    delete window.__modalOnCancel;
                }, 300);
            }
        }
        
        // Add fadeOut animation
        const style = document.createElement('style');
        style.textContent += `
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        async function addBookFromSearch(bookId, bookTitle) {
            try {
                const auth = checkAuth();
                if (!auth) return;
                
                const { token, user } = auth;
                const userId = user.id || user._id;
                
                if (bookId.startsWith('fallback')) {
                    showMessageModal('Cannot Add Book', `Cannot add "${bookTitle}" - this is a placeholder result.`, 'warning');
                    return;
                }
                
                // Add to user's profile books
                const response = await fetch(`${API_BASE_URL}/users/${userId}/books`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bookId: bookId,
                        bookTitle: bookTitle
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessageModal('Success', `"${bookTitle}" added to your profile!`, 'success');
                    closeSearchResults();
                    
                    // Remove modal
                    const modal = document.querySelector('div[style*="position: fixed; top: 0; left: 0"]');
                    if (modal) modal.remove();
                    
                } else {
                    showMessageModal('Error', data.message || 'Failed to add book', 'error');
                }
            } catch (error) {
                console.error('Error adding book from search:', error);
                showMessageModal('Error', 'Failed to add book to favorites', 'error');
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function setupGenreScrolling() {
            const scrollContainer = document.querySelector('.genres-scroll');
            const scrollLeftBtn = document.querySelector('.scroll-left');
            const scrollRightBtn = document.querySelector('.scroll-right');
            
            if (!scrollContainer || !scrollLeftBtn || !scrollRightBtn) return;
            
            scrollLeftBtn.addEventListener('click', () => {
                scrollContainer.scrollBy({ left: -300, behavior: 'smooth' });
            });
            
            scrollRightBtn.addEventListener('click', () => {
                scrollContainer.scrollBy({ left: 300, behavior: 'smooth' });
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') {
                    scrollContainer.scrollBy({ left: -300, behavior: 'smooth' });
                } else if (e.key === 'ArrowRight') {
                    scrollContainer.scrollBy({ left: 300, behavior: 'smooth' });
                }
            });
        }

        function setupScrollAnimations() {
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animated');
                    }
                });
            }, observerOptions);
            
            // Observe all sections
            document.querySelectorAll('.section').forEach(section => {
                observer.observe(section);
            });
        }

        function setupLogout() {
            const logoutBtn = document.getElementById('logoutBtn');
            if (!logoutBtn) return;
            
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                showConfirmModal('Confirm Logout', 'Are you sure you want to logout?', function() {
                    // Clear auth data
                    localStorage.removeItem('litlink_token');
                    localStorage.removeItem('litlink_user');
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    
                    showMessageModal('Success', 'Logged out successfully!', 'success');
                    
                    // Redirect to homepage
                    setTimeout(() => {
                        window.location.href = '../Homepage/index.html';
                    }, 1000);
                });
            });
        }

        function addHoverEffects() {
            // Add subtle hover effects to cards
            const cards = document.querySelectorAll('.voice-room-card, .match-card, .club-card, .quick-action-card');
            
            cards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-8px)';
                });
                
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0)';
                });
            });
        }

        // ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', async function() {
    console.log('üöÄ Dashboard Explore page loaded');
    
    try {
        // Check authentication first
        const auth = checkAuth();
        if (!auth) {
            console.error('‚ùå Authentication failed, redirecting...');
            return;
        }
        
        // Load user data first (requires auth)
        await loadUserData();
        
        // Generate fallback content (will be replaced by real data if available)
        generateVoiceRooms();
        generateDiscussions();
        generateQuickActions();
        
    } catch (error) {
        console.error('Initialization error:', error);
        // Load all fallback content even on error
        try {
            generateVoiceRooms();
            generateDiscussions();
            generateMatches();
            generateBookClubs();
            generateQuickActions();
        } catch (fallbackError) {
            console.error('Error generating fallback content:', fallbackError);
        }
    }
    
    // Setup all interactive handlers
    try {
        setupGenreScrolling();
        setupScrollAnimations();
        setupConnectButtons();
        setupRoomJoinButtons();
        setupClubJoinButtons();
        setupLogout();
        setupSearch();
        addHoverEffects();
        
        console.log('‚úÖ Dashboard Explore initialized');
    } catch (setupError) {
        console.error('Error setting up interactive handlers:', setupError);
    }
});

// Global error handler
window.addEventListener('error', function(e) {
    console.error('Global error:', e.error);
});

window.addEventListener('unhandledrejection', function(e) {
    console.error('Unhandled promise rejection:', e.reason);
});

    </script>
</body>
</html>